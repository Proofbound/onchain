<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ch02-web3-commercial-disruption – The Crypto Business Solution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../_resources/css/custom.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The Crypto Business Solution</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../en/"> 
<span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../zh/"> 
<span class="menu-text">中文</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-web3-disruption" id="toc-sec-web3-disruption" class="nav-link active" data-scroll-target="#sec-web3-disruption">Web3’s Commercial Disruption</a>
  <ul class="collapse">
  <li><a href="#the-platform-trap" id="toc-the-platform-trap" class="nav-link" data-scroll-target="#the-platform-trap">The Platform Trap</a></li>
  <li><a href="#data-sovereignty-revolution" id="toc-data-sovereignty-revolution" class="nav-link" data-scroll-target="#data-sovereignty-revolution">Data Sovereignty Revolution</a></li>
  <li><a href="#from-consumer-to-stakeholder" id="toc-from-consumer-to-stakeholder" class="nav-link" data-scroll-target="#from-consumer-to-stakeholder">From Consumer to Stakeholder</a></li>
  <li><a href="#smart-contract-commerce" id="toc-smart-contract-commerce" class="nav-link" data-scroll-target="#smart-contract-commerce">Smart Contract Commerce</a></li>
  <li><a href="#the-death-of-middlemen" id="toc-the-death-of-middlemen" class="nav-link" data-scroll-target="#the-death-of-middlemen">The Death of Middlemen</a></li>
  <li><a href="#implications-for-business-strategy" id="toc-implications-for-business-strategy" class="nav-link" data-scroll-target="#implications-for-business-strategy">Implications for Business Strategy</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sec-web3-disruption" class="level1">
<h1>Web3’s Commercial Disruption</h1>
<p>How decentralized technology rewrites business rules</p>
<p>The emergence of Web3 represents far more than a technological upgrade to existing internet infrastructure. At its core, Web3 fundamentally restructures the relationship between platforms, users, and value creation in ways that challenge the basic assumptions underlying modern commercial activity. While Web2 concentrated power and profits in the hands of platform owners, Web3 distributes both authority and economic benefits among all participants in digital ecosystems.</p>
<p>This transformation extends beyond simple technical improvements to encompass a complete rethinking of how business relationships function in digital environments. Where traditional platforms extract value from user interactions and merchant activities, Web3 systems create mechanisms for sharing value among all contributors to network effects. The implications reach into every aspect of modern commerce, from how businesses acquire customers to how individuals monetize their digital activities.</p>
<p>Understanding this disruption requires examining not just what Web3 technologies can do, but why they represent a necessary evolution beyond the limitations and contradictions that have emerged within centralized platform economies. The platform trap that currently constrains both businesses and consumers creates systemic inefficiencies that Web3 architectures are uniquely positioned to resolve.</p>
<section id="the-platform-trap" class="level2">
<h2 class="anchored" data-anchor-id="the-platform-trap">The Platform Trap</h2>
<p>Contemporary digital commerce operates through centralized platforms that have gradually concentrated enormous power over market access, customer relationships, and value distribution. These platforms initially attracted participants by offering valuable services: Amazon provided market access for sellers and convenience for buyers, Google offered free search and advertising tools, Facebook connected people across geographic boundaries. However, as these platforms achieved market dominance, their incentives shifted from serving participants toward extracting maximum value from their intermediary positions.</p>
<p>The mathematical structure of platform economics creates inherent conflicts between platform owners and other participants. Platforms generate revenue by capturing a percentage of transactions, advertising spending, or subscription fees flowing through their systems. This creates pressure to maximize the volume of value flowing through the platform while increasing the percentage captured by the platform owner. The result is a gradual squeeze on both merchants and consumers as platforms optimize for their own profitability rather than ecosystem health.</p>
<p>Consider the evolution of Amazon’s relationship with third-party sellers. Initially, Amazon charged modest fees and provided valuable services that genuinely helped merchants reach new customers. Over time, however, the platform has introduced increasingly complex fee structures, mandatory advertising requirements, and restrictive policies that effectively force merchants to surrender larger portions of their revenue to maintain market access. Merchants who achieved success on the platform often find themselves trapped: they cannot afford to leave because Amazon represents such a large portion of their sales, yet they cannot achieve sustainable profitability because Amazon’s fees consume most of their margins.</p>
<p>This dynamic extends beyond individual transactions to encompass data ownership and customer relationships. Platform merchants cannot access detailed customer information, cannot build direct relationships with buyers, and cannot transfer their customer base to alternative platforms. The platform owns all customer data and relationships, using this information asymmetry to maintain control over market access. Merchants become dependent on the platform’s algorithms, advertising systems, and policy decisions, with little recourse when these systems change in ways that damage their businesses.</p>
<p>The platform trap affects consumers as well, though often in less visible ways. While platforms provide convenience and selection, they also create filter bubbles, manipulate purchasing decisions through algorithmic recommendations, and gradually increase prices as they achieve market dominance. Consumers generate valuable data through their interactions with platforms, yet receive no compensation for this value creation. Instead, their data is sold to advertisers and used to optimize extraction of money from their wallets.</p>
<p>Perhaps most significantly, the platform model creates systematic underinvestment in ecosystem development and participant success. Since platforms profit from their intermediary position rather than from the success of ecosystem participants, they have limited incentives to help merchants improve their businesses or to provide consumers with genuinely optimal outcomes. The platform’s interests align with maintaining dependency and extracting value rather than creating conditions for broad-based prosperity among participants.</p>
<p><img src="../assets/images/ch2-overview.jpg" class="img-fluid"></p>
</section>
<section id="data-sovereignty-revolution" class="level2">
<h2 class="anchored" data-anchor-id="data-sovereignty-revolution">Data Sovereignty Revolution</h2>
<p>Web3 technologies introduce the possibility of data sovereignty, fundamentally altering the balance of power between platforms and users. In current systems, every click, purchase, search, and interaction generates data that flows to platform owners who use this information to optimize their own revenue generation. Users have no visibility into how their data is collected, processed, or monetized, and receive no compensation for the value their activities create.</p>
<p>Decentralized identity systems enable individuals to own and control their digital identities across multiple platforms and applications. Rather than creating separate accounts for each service and surrendering personal information to each platform, users can maintain portable identities that they fully control. This shift has profound implications for how digital commerce functions, as it eliminates platforms’ ability to trap users through data lock-in effects.</p>
<p>When users own their data, they can choose which information to share with different services and under what conditions. They can grant temporary access permissions that can be revoked at any time. Most importantly, they can negotiate compensation for sharing valuable data or participating in data-generating activities. This creates market mechanisms for data exchange rather than the current system of uncompensated extraction.</p>
<p>The implications extend to customer relationships in commercial contexts. Merchants who interact with customers through Web3 systems can develop direct relationships without intermediary platforms controlling access. Customer data remains with customers, who can choose to share purchase history, preferences, and other valuable information directly with merchants they trust. This enables more genuine relationships between businesses and customers while eliminating the platform tax on these interactions.</p>
<p>Decentralized storage systems ensure that user data cannot be lost, corrupted, or manipulated by platform owners. Information stored on distributed networks remains accessible to users regardless of what happens to any particular platform or service provider. This creates genuine data portability, enabling users to move between services while maintaining their digital history and relationships.</p>
<p>The data sovereignty revolution also enables new forms of value creation through user participation. When users own their data and interactions, they can choose to monetize these assets directly rather than allowing platforms to capture all the value. This might involve selling data to researchers, participating in content creation that generates direct revenue, or contributing to network effects that create tokenized rewards.</p>
</section>
<section id="from-consumer-to-stakeholder" class="level2">
<h2 class="anchored" data-anchor-id="from-consumer-to-stakeholder">From Consumer to Stakeholder</h2>
<p>Traditional platform relationships cast users as consumers who purchase products or services in exchange for money, or as content creators who provide material in exchange for platform-mediated revenue sharing. Web3 systems enable a fundamental role transformation where users become stakeholders with ownership interests in the platforms and networks they help create and maintain.</p>
<p>This transformation occurs through token-based ownership systems that distribute economic rights to network participants based on their contributions to network value. Rather than working for platforms that capture most of the value from user activities, participants can earn ownership stakes in the networks they help build and maintain. These ownership stakes typically take the form of governance tokens that provide voting rights on network decisions and economic tokens that entitle holders to shares of network revenue.</p>
<p>The stakeholder model aligns incentives between platforms and participants in ways that platform-based systems cannot achieve. When users own portions of the networks they participate in, they benefit directly from network growth and success. This creates powerful incentives for users to contribute high-quality content, provide helpful feedback, recruit new participants, and support network development in other ways. The result is typically faster growth and higher-quality outcomes than centralized platforms can achieve through purely extractive relationships.</p>
<p>Governance rights associated with stakeholder positions enable genuine democratic participation in platform development and policy decisions. Rather than accepting whatever changes platform owners decide to implement, stakeholders can propose modifications, vote on important decisions, and collectively guide network evolution. This creates systems that remain responsive to participant needs rather than optimizing solely for owner benefit.</p>
<p>The economic implications of stakeholder participation compound over time as successful networks grow in value. Early participants who help establish and develop networks can see substantial appreciation in their ownership stakes as networks achieve scale and adoption. This creates incentives for long-term commitment and high-quality participation rather than the short-term extraction that characterizes many platform relationships.</p>
<p>Furthermore, stakeholder models enable risk sharing and collaborative investment in network development. When participants have ownership stakes, they become willing to invest time, money, and effort in network improvements because they will share in the benefits of these investments. This can accelerate innovation and development compared to systems where only platform owners benefit from network improvements.</p>
</section>
<section id="smart-contract-commerce" class="level2">
<h2 class="anchored" data-anchor-id="smart-contract-commerce">Smart Contract Commerce</h2>
<p>Smart contracts represent one of the most significant innovations in Web3 technology, enabling automated execution of agreements without requiring trusted intermediaries. In commercial contexts, smart contracts can automate payment processing, enforce service agreements, distribute revenue shares, and manage complex multi-party transactions with mathematical precision and complete transparency.</p>
<p>The elimination of intermediaries through smart contract automation reduces transaction costs while increasing reliability and speed of execution. Traditional commercial transactions often require banks, payment processors, escrow services, and other intermediaries to ensure that all parties fulfill their obligations. Each intermediary adds cost, complexity, and potential points of failure to the transaction process. Smart contracts can replace many of these intermediaries with automated code that executes predefined logic when specified conditions are met.</p>
<p>Consider a typical e-commerce transaction involving a merchant, customer, payment processor, and shipping company. Traditional systems require multiple intermediaries to coordinate these interactions, with each taking fees and introducing delays. A smart contract system could automatically process payment when goods are delivered, distribute appropriate portions to the merchant and shipping company, handle tax calculations, and trigger customer service processes if problems arise. The entire transaction executes according to predefined rules without requiring manual intervention or intermediary coordination.</p>
<p>Smart contracts also enable more sophisticated commercial arrangements that would be impractical to manage through traditional systems. Revenue sharing agreements between multiple parties can be automated to ensure accurate and timely distribution of funds according to complex formulas. Subscription services can automatically adjust pricing based on usage patterns or market conditions. Insurance claims can be processed automatically when triggering events occur. These capabilities enable new business models that were previously too complex or expensive to implement.</p>
<p>The transparency of smart contract systems builds trust between commercial partners by making all transaction logic visible and verifiable. Participants can examine the code that governs their interactions, ensuring that automated systems will behave as expected. This transparency reduces disputes and enables cooperation between parties who might not otherwise trust each other to honor complex agreements.</p>
<p>Smart contracts also enable programmable money that can automatically enforce spending rules, savings goals, and investment strategies. Rather than relying on individual discipline or third-party financial services, individuals can create automated systems that allocate income according to predetermined rules, invest in diversified portfolios, and execute complex financial strategies without ongoing manual management.</p>
</section>
<section id="the-death-of-middlemen" class="level2">
<h2 class="anchored" data-anchor-id="the-death-of-middlemen">The Death of Middlemen</h2>
<p>Web3 technologies enable direct peer-to-peer transactions that eliminate many traditional intermediary roles while creating new forms of value creation through network participation. Rather than paying intermediaries to facilitate transactions, participants can interact directly while contributing to shared infrastructure that serves their collective interests.</p>
<p>Decentralized finance protocols demonstrate how intermediary elimination works in practice. Traditional banking requires customers to deposit money with financial institutions that then lend these funds to borrowers while capturing the interest rate spread. DeFi protocols enable depositors to lend directly to borrowers through automated systems, often earning higher returns while borrowers pay lower rates. The intermediary profits are eliminated, with the savings shared between lenders and borrowers.</p>
<p>Similar dynamics apply to many other commercial sectors. Content creators can distribute their work directly to audiences through decentralized platforms, keeping larger portions of revenue that would otherwise flow to platform intermediaries. Freelancers can connect with clients through peer-to-peer networks that charge minimal fees compared to traditional freelancing platforms. Merchants can sell directly to consumers through decentralized marketplaces that take smaller commissions than centralized platforms.</p>
<p>The elimination of intermediaries does not mean the elimination of valuable services that intermediaries traditionally provided. Instead, these services become distributed among network participants or automated through smart contracts. Quality assurance, dispute resolution, payment processing, and other intermediary functions continue to exist but are provided through decentralized mechanisms rather than centralized intermediaries.</p>
<p>This transition creates opportunities for individuals to earn income by providing specific services within decentralized networks rather than working for intermediary companies. Network participants can earn rewards for content moderation, dispute resolution, quality verification, customer service, and many other functions that were previously performed by platform employees. This creates more flexible and often more lucrative opportunities for individuals while reducing the overhead costs associated with centralized intermediary organizations.</p>
<p>The death of traditional intermediaries also enables more direct relationships between producers and consumers, leading to better price discovery and more efficient markets. When multiple layers of intermediaries are removed, both producers and consumers can capture larger portions of the value created through their interactions. This typically results in lower prices for consumers and higher revenues for producers, with the difference representing the elimination of intermediary extraction.</p>
</section>
<section id="implications-for-business-strategy" class="level2">
<h2 class="anchored" data-anchor-id="implications-for-business-strategy">Implications for Business Strategy</h2>
<p>The transition to Web3 commerce requires fundamental changes in how businesses approach customer acquisition, relationship management, and value creation. Companies that understand and adapt to these changes will find significant competitive advantages, while those that cling to platform-dependent strategies may find themselves increasingly disadvantaged.</p>
<p>Customer acquisition in Web3 environments focuses on providing genuine value and building trust rather than purchasing attention through advertising platforms. Since Web3 users own their data and identities, they can more easily evaluate and compare different options. Businesses must compete on the basis of actual value provided rather than marketing sophistication or advertising spending power.</p>
<p>Relationship management shifts from platform-mediated interactions toward direct engagement with customers who own their data and identities. This enables deeper, more authentic relationships but requires businesses to provide ongoing value rather than relying on platform lock-in effects to maintain customer loyalty. Companies that excel at creating genuine value for customers will thrive, while those that depend on information asymmetries or switching costs will struggle.</p>
<p>Value creation opportunities expand significantly in Web3 environments as businesses can participate in network effects and token economies rather than simply extracting profits from transactions. Companies can create and participate in decentralized networks that grow in value as they attract more participants. This can provide exponential growth opportunities that are not available through traditional business models.</p>
<p>The Web3 transition represents both a technological shift and a philosophical evolution toward more equitable and efficient forms of digital commerce. As we will explore in Chapter 3, the practical implementation of these principles requires systematic approaches to platform design, token economics, and community governance. The six pillars of OnChain Commerce provide a framework for understanding how these abstract concepts translate into concrete business systems that can operate at scale while maintaining the benefits of decentralization and participant ownership.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025 Global Business Chain, Inc. <br> <a href="en/">English</a> | <a href="zh/">中文</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>